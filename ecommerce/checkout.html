<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ShopVue - Checkout">
    <title>ShopVue - Checkout</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="assets/css/main.css?v=14">
</head>
<body>
    <!-- Vue App Mount Point -->
    <div id="app">
        <!-- Header Component -->
        <header-component 
            :cart-count="cartCount"
            :current-page="currentPage"
            :logo-image="logoImage"
            :is-logged-in="isLoggedIn"
            :user-email="userEmail"
            @navigate="handleNavigate"
            @search="handleSearch"
            @login="handleLogin"
            @logout="handleLogout"
            @open-account="openAccountSidebar"
            @change-address="handleChangeAddress"
        ></header-component>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Hero Section -->
            <section class="hero-section">
                <h1 class="page-title">Checkout</h1>
                <p class="page-subtitle">Complete your order</p>
            </section>

            <!-- Checkout Section -->
            <section class="checkout-section">
                <div v-if="cartItems.length === 0" class="checkout-empty">
                    <h2>Your cart is empty</h2>
                    <p>Add some products to your cart before checkout!</p>
                    <button @click="handleNavigate('products')" class="btn-primary">
                        Continue Shopping
                    </button>
                </div>

                <div v-else class="checkout-container">
                    <!-- Checkout Form -->
                    <div class="checkout-form-section">
                        <!-- Delivery Address -->
                        <div class="checkout-section-card">
                            <h2 class="section-title">Delivery Address</h2>
                            <div class="form-group">
                                <label for="fullName">Full Name *</label>
                                <input 
                                    type="text" 
                                    id="fullName"
                                    v-model="deliveryAddress.fullName"
                                    placeholder="John Doe"
                                    required
                                >
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number *</label>
                                <input 
                                    type="tel" 
                                    id="phone"
                                    v-model="deliveryAddress.phone"
                                    placeholder="+1 234 567 8900"
                                    required
                                >
                            </div>
                            <div class="form-group">
                                <label for="address">Street Address *</label>
                                <input 
                                    type="text" 
                                    id="address"
                                    v-model="deliveryAddress.address"
                                    placeholder="123 Main Street"
                                    required
                                >
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="city">City *</label>
                                    <input 
                                        type="text" 
                                        id="city"
                                        v-model="deliveryAddress.city"
                                        placeholder="New York"
                                        required
                                    >
                                </div>
                                <div class="form-group">
                                    <label for="state">State *</label>
                                    <input 
                                        type="text" 
                                        id="state"
                                        v-model="deliveryAddress.state"
                                        placeholder="NY"
                                        required
                                    >
                                </div>
                                <div class="form-group">
                                    <label for="zipCode">ZIP Code *</label>
                                    <input 
                                        type="text" 
                                        id="zipCode"
                                        v-model="deliveryAddress.zipCode"
                                        placeholder="10001"
                                        required
                                    >
                                </div>
                            </div>
                        </div>

                        <!-- Delivery Timeline -->
                        <div class="checkout-section-card">
                            <h2 class="section-title">Delivery Timeline</h2>
                            <div class="delivery-options">
                                <label 
                                    v-for="option in deliveryOptions" 
                                    :key="option.value"
                                    class="delivery-option"
                                    :class="{ active: selectedDelivery === option.value }"
                                >
                                    <input 
                                        type="radio" 
                                        :value="option.value"
                                        v-model="selectedDelivery"
                                        @change="updateDeliveryTimeline"
                                    >
                                    <div class="delivery-option-content">
                                        <div class="delivery-option-header">
                                            <span class="delivery-option-title">{{ option.label }}</span>
                                            <span class="delivery-option-price" v-if="option.price > 0">+{{ formatPrice(option.price) }} KWD</span>
                                            <span class="delivery-option-price free" v-else>Free</span>
                                        </div>
                                        <p class="delivery-option-desc">{{ option.description }}</p>
                                        <p class="delivery-option-date">{{ option.date }}</p>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Payment Method -->
                        <div class="checkout-section-card">
                            <h2 class="section-title">Payment Method</h2>
                            <div class="payment-options">
                                <label 
                                    v-for="method in paymentMethods" 
                                    :key="method.value"
                                    class="payment-option"
                                    :class="{ active: selectedPayment === method.value }"
                                >
                                    <input 
                                        type="radio" 
                                        :value="method.value"
                                        v-model="selectedPayment"
                                    >
                                    <div class="payment-option-content">
                                        <div class="payment-icon">
                                            <svg v-if="method.icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                <path v-for="path in method.icon" :key="path" :d="path"></path>
                                            </svg>
                                        </div>
                                        <span class="payment-option-label">{{ method.label }}</span>
                                    </div>
                                </label>
                            </div>

                            <!-- Credit Card Details (if credit card selected) -->
                            <div v-if="selectedPayment === 'credit-card'" class="payment-details">
                                <div class="form-group">
                                    <label for="cardNumber">Card Number *</label>
                                    <input 
                                        type="text" 
                                        id="cardNumber"
                                        v-model="paymentDetails.cardNumber"
                                        placeholder="1234 5678 9012 3456"
                                        maxlength="19"
                                        @input="formatCardNumber"
                                    >
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="expiryDate">Expiry Date *</label>
                                        <input 
                                            type="text" 
                                            id="expiryDate"
                                            v-model="paymentDetails.expiryDate"
                                            placeholder="MM/YY"
                                            maxlength="5"
                                            @input="formatExpiryDate"
                                        >
                                    </div>
                                    <div class="form-group">
                                        <label for="cvv">CVV *</label>
                                        <input 
                                            type="text" 
                                            id="cvv"
                                            v-model="paymentDetails.cvv"
                                            placeholder="123"
                                            maxlength="4"
                                        >
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="cardName">Cardholder Name *</label>
                                    <input 
                                        type="text" 
                                        id="cardName"
                                        v-model="paymentDetails.cardName"
                                        placeholder="John Doe"
                                    >
                                </div>
                            </div>
                        </div>

                        <!-- Voucher Code -->
                        <div class="checkout-section-card">
                            <h2 class="section-title">Voucher Code</h2>
                            <div class="voucher-section">
                                <div class="voucher-input-group">
                                    <input 
                                        type="text" 
                                        v-model="voucherCode"
                                        placeholder="Enter voucher code"
                                        class="voucher-input"
                                        :class="{ 'has-error': voucherError, 'has-success': voucherApplied }"
                                    >
                                    <button 
                                        @click="applyVoucher" 
                                        class="btn-apply-voucher"
                                        :disabled="voucherApplied || !voucherCode"
                                    >
                                        {{ voucherApplied ? 'Applied' : 'Apply' }}
                                    </button>
                                </div>
                                <p v-if="voucherError" class="voucher-error">{{ voucherError }}</p>
                                <p v-if="voucherApplied && voucherDiscount" class="voucher-success">
                                    Voucher applied! You saved {{ formatPrice(voucherDiscount) }} KWD
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Order Summary Sidebar -->
                    <div class="checkout-summary">
                        <h3>Order Summary</h3>
                        
                        <!-- Cart Items -->
                        <div class="summary-items">
                            <div 
                                v-for="item in cartItems" 
                                :key="item.id" 
                                class="summary-item"
                            >
                                <div class="summary-item-image">
                                    <img :src="item.image" :alt="item.name" @error="handleImageError">
                                </div>
                                <div class="summary-item-details">
                                    <h4>{{ item.name }}</h4>
                                    <p>Qty: {{ item.quantity }} × {{ formatPrice(item.price) }} KWD</p>
                                </div>
                                <div class="summary-item-total">
                                    {{ formatPrice(item.price * item.quantity) }} KWD
                                </div>
                            </div>
                        </div>

                        <!-- Order Totals -->
                        <div class="summary-totals">
                            <div class="summary-row">
                                <span>Subtotal:</span>
                                <span>{{ formatPrice(subtotal) }} KWD</span>
                            </div>
                            <div class="summary-row">
                                <span>Delivery:</span>
                                <span>{{ selectedDeliveryPrice > 0 ? '+' : '' }}{{ formatPrice(selectedDeliveryPrice) }} KWD</span>
                            </div>
                            <div v-if="voucherDiscount > 0" class="summary-row discount">
                                <span>Voucher Discount:</span>
                                <span>-{{ formatPrice(voucherDiscount) }} KWD</span>
                            </div>
                            <div class="summary-row">
                                <span>Tax (10%):</span>
                                <span>{{ formatPrice(tax) }} KWD</span>
                            </div>
                            <div class="summary-divider"></div>
                            <div class="summary-row summary-total">
                                <span>Total:</span>
                                <span>{{ formatPrice(total) }} KWD</span>
                            </div>
                        </div>

                        <!-- Place Order Button -->
                        <button 
                            @click="placeOrder" 
                            class="btn-place-order"
                            :disabled="!isFormValid"
                        >
                            Place Order
                        </button>

                        <button @click="handleNavigate('cart')" class="btn-back-to-cart">
                            ← Back to Cart
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer Component -->
        <footer-component 
            @navigate="handleNavigate"
            @social-click="handleSocialClick"
        ></footer-component>

        <!-- Account Sidebar -->
        <account-sidebar
            :show="showAccountSidebar"
            :user-data="userData"
            @close="closeAccountSidebar"
            @navigate-account="handleNavigateAccount"
            @logout="handleLogout"
        ></account-sidebar>
    </div>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- API Service (must load before components) -->
    <script src="assets/js/services/api.js?v=5"></script>
    
    <!-- Components (must load before app.js) -->
    <script src="assets/js/components/Header.js?v=6"></script>
    <script src="assets/js/components/Footer.js?v=3"></script>
    <script src="assets/js/components/AccountSidebar.js?v=1"></script>
    
    <!-- Checkout App -->
    <script src="assets/js/checkout-app.js?v=6"></script>
</body>
</html>

